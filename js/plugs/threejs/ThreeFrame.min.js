(function(){var f=!1,a={$namespace:function(a){if(!a)return window;var c,e=a.split("."),g;g=window;a=0;for(c=e.length;a<c;a++){var d=e[a];g[d]=g[d]||{};g=g[d]}return g},$package:function(a,c){var e;"function"==typeof a?(c=a,e=window):"string"==typeof a?e=this.$namespace(a):"object"==typeof a&&(e=a);c.call(e,this)},"extends":function(a,c,e){function g(b,a,c){var d=!0;!1===c&&(d=!1);if(a instanceof Array){var k=0;for(c=a.length;k<c;k++)g(b,a[k],d)}for(k in a)!d&&k in b||(b[k]=a[k]);return b}a=g(a,c,e);for(var d in c)delete a[d];return a},setDebug:function(a){f=value},log:function(a){console.log(a)},warn:function(a){console.warn(a)},error:function(a){console.error(a)},version:"0.0.1"};a.isDebug=f;window.ThreeFrame=a;window.TF=a;"function"===typeof define&&define(function(){return a})})();ThreeFrame.$package(function(f){var a={scene:null,camera:null,renderer:null};a.renderDom=document.body;a.raycaster=new THREE.Raycaster;a.raycasterFlag=!1;a.selectedObj=null;a.lookAtObj=null;a.mouse=new THREE.Vector2(0,0);a.mouse.x=NaN;a.mouse.y=NaN;a.getSceneWidth=function(){return a.renderDom==document.body?window.innerWidth:a.renderDom.clientWidth};a.getSceneHeight=function(){return a.renderDom==document.body?window.innerHeight:a.renderDom.clientHeight};f.base=a});ThreeFrame.$package(function(f){var a=f.base,a={camera:{type:"PerspectiveCamera",fov:90,aspect:a.getSceneWidth()/a.getSceneHeight(),near:1,far:1E4,left:-a.getSceneWidth()/2,right:a.getSceneWidth()/2,top:a.getSceneHeight()/2,bottom:-a.getSceneHeight()/2},render:{alpha:!1,antialias:!0,clearColor:0,depth:!0,logarithmicDepthBuffer:!1,precision:"highp",premultipliedAlpha:!1,preserveDrawingBuffer:!1,stencil:!0},raycaster:!0,resize:!0,renderPause:!1};f.setting=a});ThreeFrame.$package(function(f){var a=f.base,h={},c=null;h.createOrbit=function(){null==c&&(c=new THREE.OrbitControls(a.camera,a.renderDom));return c};h.createTrackball=function(){null==c&&(c=new THREE.TrackballControls(a.camera,a.renderDom));return c};h.update=function(){c&&c.update()};f.control=h});ThreeFrame.$package(function(f){function a(){requestAnimationFrame(a);if(!e.renderPause){e.resize&&f.resize();f.runActions();if(e.raycaster){var b,g=d.length,k;for(b=0;b<g;b++)if(k=d[b],null==k.parent){d.splice(b,1);console.warn("\u68c0\u6d4b\u5230\u4e0d\u590d\u5408\u5c04\u7ebf\u68c0\u6d4b\u7684\u5bf9\u8c61 \u79fb\u9664");break}c.raycaster.setFromCamera(c.mouse,c.camera);b=c.raycaster.intersectObjects(d,!0);for(var l;0<b.length;){l=b[0];break}l&&null==c.selectedObj&&(c.selectedObj=l,c.selectedObj.object&&c.selectedObj.object.onMouseDown&&!c.selectedObj.object.isTouchStart&&(c.selectedObj.object.isTouchStart=!0,c.selectedObj.object.onMouseDown(c.selectedObj)))}c.renderer.render(c.scene,c.camera)}}var h,c=f.base,e=f.setting,g=!1,d=[];f.runActions=function(){};f.init=function(b,a,d,l){if(g)f.warn("\u76ee\u524d\u652f\u6301\u521d\u59cb\u5316\u4e00\u4e2a3D\u573a\u666f");else return g=!0,(h=(h=document.getElementById(b))?h:c.renderDom)?(c.renderDom=h,b=c.scene,null==b&&(b=new THREE.Scene,c.scene=b),b=c.renderer,null==b&&(d=f["extends"]({},[e.render,d]),b=new THREE.WebGLRenderer(d),b.setSize(c.getSceneWidth(),c.getSceneHeight()),h.appendChild(b.domElement),c.renderer=b),d=c.camera,null==d&&(l=f["extends"]({},[e.camera,l]),d="OrthographicCamera"!=l.type?new THREE.PerspectiveCamera(l.fov,l.aspect,l.near,l.far):new THREE.OrthographicCamera(l.left,l.right,l.top,l.bottom,l.near,l.far),c.camera=d)):f.error(b+"dom\u5bf9\u8c61\u4e0d\u5b58\u5728"),{scene:c.scene,camera:c.camera,renderer:c.renderer}};f.run=a;f.addRaycaster=function(b){d.push(b)}});ThreeFrame.$package(function(f){function a(a){b.mouse.x=(a.clientX-b.renderDom.offsetLeft)/b.getSceneWidth()*2-1;b.mouse.y=2*-((a.clientY-b.renderDom.offsetTop)/b.getSceneHeight())+1}function h(a){a.preventDefault();if(b.selectedObj&&b.selectedObj.object&&b.selectedObj.object.onMouseMove)b.selectedObj.object.onMouseMove(b.selectedObj)}function c(a){b.mouse.x=NaN;b.mouse.y=NaN;if(b.selectedObj&&b.selectedObj.object){if(b.selectedObj.object.onMouseUp)b.selectedObj.object.onMouseUp(b.selectedObj);b.selectedObj.object.isTouchStart=!1;b.selectedObj=null}}function e(a){b.mouse.x=(a.targetTouches[0].clientX-b.renderDom.offsetLeft)/b.getSceneWidth()*2-1;b.mouse.y=2*-((a.targetTouches[0].clientY-b.renderDom.offsetTop)/b.getSceneHeight())+1}function g(a){a.preventDefault();if(b.selectedObj&&b.selectedObj.object&&b.selectedObj.object.onMouseMove)b.selectedObj.object.onMouseMove(b.selectedObj)}function d(a){b.mouse.x=NaN;b.mouse.y=NaN;if(b.selectedObj&&b.selectedObj.object){if(b.selectedObj.object.onMouseUp)b.selectedObj.object.onMouseUp(b.selectedObj);b.selectedObj.object.isTouchStart=!1;b.selectedObj=null}}var b=f.base;f.resize=function(){var a=b.getSceneWidth(),c=b.getSceneHeight();b.camera&&(b.camera.aspect=a/c,b.camera.updateProjectionMatrix(),b.renderer.setSize(a,c))};f.openClickEvent=function(){b.raycasterFlag||(b.raycasterFlag=!0,b.renderDom.addEventListener("mousedown",a),b.renderDom.addEventListener("mousemove",h),b.renderDom.addEventListener("mouseup",c),b.renderDom.addEventListener("touchstart",e),b.renderDom.addEventListener("touchmove",g),b.renderDom.addEventListener("touchend",d))};f.closeClickEvent=function(){b.raycasterFlag&&(b.raycasterFlag=!1,b.renderDom.removeEventListener("mousedown",a),b.renderDom.removeEventListener("mousemove",h),b.renderDom.removeEventListener("mouseup",c),b.renderDom.removeEventListener("touchstart",e),b.renderDom.removeEventListener("touchmove",g),b.renderDom.removeEventListener("touchend",d))}});ThreeFrame.$package(function(f){var a=f.base,h=new THREE.Vector3(0,0,0),c=new THREE.Vector3(0,0,0),e=.5*a.getSceneWidth(),g=.5*a.getSceneHeight();f.utils={lookAt:function(d,b){a.lookAtObj=d;var g=a.camera;h.x=100;TweenLite.to(h,b,{x:5630,onUpate:function(){console.log(h);g.lookAt(c)},onComplete:function(){f.log("tweenlite onComplete")}})},worldPosToScreenPos:function(a){a=a.project(camera);return{x:Math.round(a.x*e+e),y:Math.round(-a.y*g+g)}}}});ThreeFrame.$package(function(f){f.createBox=function(a){var h={width:1,height:1,depth:1,color:16711680},h=f["extends"]({},[h,a]);return new THREE.Mesh(new THREE.BoxGeometry(h.width,h.height,h.depth),new THREE.MeshBasicMaterial({color:h.color}))}});ThreeFrame.$package(function(f){var a=f.anim||{},h=function(){function a(){g.removeEventListener("finished",a);l(k.name);l=null}var e=this,g,d,b={},f,k=null,l=null;e.mesh=null;e.init=function(){d=e.mesh.geometry.morphTargets;g=new THREE.AnimationMixer(e.mesh);0<d.length&&(k=THREE.AnimationClip.CreateFromMorphTargetSequence("anim",d,30),f=g.clipAction(k),f.setDuration(500).play())};e.play=function(c,d,e,h){var n=b[c];d=d||500;e=e||!1;l=h||function(){};null==n?console.warn(c+"\u52a8\u4f5c\u4e0d\u5b58\u5728"):(g.existingAction(k)&&g.uncacheClip(k),k=n,f=g.clipAction(k),e?f.loop=THREE.LoopRepeat:(f.loop=THREE.LoopOnce,g.removeEventListener("finished",a),g.addEventListener("finished",a)),f.setDuration(d).play())};e.clip=function(a,c,g){for(var e=[];a<c;a++)e.push(d[a]);c=THREE.AnimationClip.CreateFromMorphTargetSequence(g,e,30);b[g]=c};e.update=function(){g&&g.update(1)};e.destory=function(){g&&(g.removeEventListener("finished",a),g.stopAllAction(),g.existingAction(k)&&g.uncacheClip(k),g=null);b={};d=[]}};a.createMorphAnim=function(a,e,g){var c=new h,b=new THREE.JSONLoader,f;e&&(f=(new THREE.TextureLoader).load(e));b.load(a,function(a,b){for(var d in b)0<a.bones.length&&(b[d].skinning=!0),b[d].side=THREE.DoubleSide,b[d].morphTargets=!0,f&&(b[d].map=f);d=new THREE.SkinnedMesh(a,b);c.mesh=d;c.init();g(c)})};f.anim=a});ThreeFrame.$package(function(f){var a=f.anim||{},h=function(){function a(){g.removeEventListener("finished",a);d(l.name);d=null}var e=this,g,d=null,b,f=[],k,l=null;e.mesh=null;e.init=function(){g=new THREE.AnimationMixer(e.mesh);b=e.mesh.geometry.animations;for(var a=b.length,c=0;c<a;c++)f.push(b[c].name)};e.getAllAnimationNames=function(){return f};e.play=function(c,e,h,m){e=e||500;h=h||!1;d=m||function(){};m=f.indexOf(c);-1==m?console.warn(c+"\u52a8\u753b\u4e0d\u5b58\u5728"):(g.stopAllAction(),l=b[m],k=g.clipAction(l),h?k.loop=THREE.LoopRepeat:(k.loop=THREE.LoopOnce,g.removeEventListener("finished",a),g.addEventListener("finished",a)),k.setDuration(e).play())};e.update=function(){g&&g.update(1)};e.destory=function(){g&&(g.removeEventListener("finished",a),g.stopAllAction(),g=null);e.mesh=null}};a.createSkeletonAnim=function(a,e,g){var c=new h,b=new THREE.JSONLoader,f;e&&(f=(new THREE.TextureLoader).load(e));b.load(a,function(a,b){for(var d in b)b[d].skinning=!0,b[d].side=THREE.DoubleSide,f&&(b[d].map=f);d=new THREE.SkinnedMesh(a,b);c.mesh=d;c.init();g(c)})};f.anim=a});ThreeFrame.$package(function(f){var a={},h=new THREE.TextureLoader,c=0,e=0,g=1E4,d={},b=function(){console.log("complate")},m=function(a){console.log(a)};a.addTexture=function(a,b){b=b?b:a;var f={},e;e=0;for(var g in d)d[g].url==a&&(e=2);if(null!=d[b]||void 0!=d[b])e=1;1==e?console.error("\u7eb9\u7406\u540d\u5b57\uff1a"+b+" \u91cd\u590d"):2==e?console.error("\u56fe\u7247\u5730\u5740\uff1a"+a+" \u91cd\u590d"):(f.url=a,d[b]=f,c++)};a.getTexture=function(a){if(null==d[a]||void 0==d[a])console.error(a+" \u662f\u4e0d\u5b58\u5728\u7684\u7eb9\u7406\u540d\u79f0\u6216\u8be5\u7eb9\u7406\u672a\u52a0\u8f7d\u5b8c\u6210");else return d[a].texture};a.DestroyTexture=function(a){null==d[a]||void 0==d[a]?console.error(a+" \u662f\u4e0d\u5b58\u5728\u7684\u7eb9\u7406\u540d\u79f0"):(d[a].texture.dispose(),d[a]=null,delete d[a],c--,e--)};a.start=function(a){var l=f["extends"]({},[{onload:b,onprogress:m,clearTime:g},a]);g=l.time;for(var k in d)if(null==d[k].texture||void 0==d[k].texture)d[k].texture=h.load(d[k].url,function(){e++;var a=parseInt(e/c*100);l.onprogress(a);if(e>=c)l.onload()})};f.loader=a});